{"version":3,"file":"js/838.684c11e1.js","mappings":"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","sources":["webpack://hm-shopping/./src/views/AddAddress/AddAddress.vue","webpack://hm-shopping/src/views/AddAddress/AddAddress.vue","webpack://hm-shopping/./src/views/AddAddress/AddAddress.vue?7542","webpack://hm-shopping/./src/views/AddAddress/AddAddress.vue?ae8d"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"addAddress\"},[_c('van-nav-bar',{attrs:{\"placeholder\":\"\",\"fixed\":\"\",\"title\":\"新增收货地址\",\"left-arrow\":\"\"},on:{\"click-left\":function($event){return _vm.$router.go(-1)}}}),_c('div',{staticClass:\"edit\",staticStyle:{\"height\":\"calc(100vh - 46px)\"}},[_c('div',{staticClass:\"title\",staticStyle:{\"padding\":\"12px 12px 0 12px\"}},[_vm._v(\" 收货地址 \")]),_c('van-address-edit',{attrs:{\"area-list\":_vm.areaList},on:{\"save\":_vm.onSave}})],1)],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<script>\r\nimport {getRegionApi} from \"@/api/address\";\r\nimport {mapActions} from \"vuex\";\r\n\r\nexport default {\r\n  name: \"AddAddress\",\r\n  async created() {\r\n    // 获取后端的省市区数据\r\n    const res = await getRegionApi()\r\n    this.originAreaList = res.data.list\r\n  },\r\n  data() {\r\n    return {\r\n      originAreaList: null, // 原始省市区列表\r\n      idMapping: {\r\n        province: {}, // { oldId: newId }\r\n        city: {},\r\n        region: {}\r\n      }\r\n    }\r\n  },\r\n  computed: {\r\n    province() {\r\n      return this.idMapping.province\r\n    },\r\n    city() {\r\n      return this.idMapping.city\r\n    },\r\n    region() {\r\n      return this.idMapping.region\r\n    },\r\n\r\n    // 传递给组件的省市区数据\r\n    areaList() {\r\n      // 没有后端的省市区数据直接返回空对象\r\n      if (!this.originAreaList) return {}\r\n\r\n      const areaList = {\r\n        province_list: {},\r\n        city_list: {},\r\n        county_list: {}\r\n      };\r\n\r\n      // 创建临时的 idMapping，等会填充完把 data 中的 idMapping 整个换掉，确保响应式\r\n      // addressInfo 这个 getters 会在 idMapping 整个换掉的时候再次触发，这个方案更好\r\n      // 其实 $set 方案也不错，$set 往一个对象obj加入一个带有 get 和 set 的属性 a，并且会触发对象 obj 的所有依赖\r\n      // 如果 obj 的依赖中有使用了 obj.a 的地方，此时属性 a 趁机收集自己的依赖，也是一个完美的方案\r\n      const idMappingTemp = {\r\n        province: {}, // { oldId: newId } 其实就是后端返回的 id 和组件要求的 id 不一致\r\n        city: {},\r\n        region: {}\r\n      }\r\n\r\n      let provinceIndex = 1;\r\n      const provinces = this.originAreaList\r\n\r\n      Object.values(provinces).forEach(province => {\r\n        const provinceId = String(provinceIndex).padStart(2, '0');\r\n        const provinceCode = provinceId + '0000';\r\n        areaList.province_list[provinceCode] = province.name;\r\n\r\n        // 保存新旧省份ID的映射，这里的 provinceId 是只有两位的，provinceCode 是有六位的\r\n        idMappingTemp.province[province.id] = provinceCode\r\n\r\n        if (province.city) {\r\n          let cityIndex = 1;\r\n          Object.values(province.city).forEach(city => {\r\n            const cityId = String(cityIndex).padStart(2, '0');\r\n            const cityCode = provinceId + cityId + '00';\r\n            areaList.city_list[cityCode] = city.name;\r\n\r\n            // 保存新旧城市ID的映射\r\n            idMappingTemp.city[city.id] = cityCode\r\n\r\n            if (city.region) {\r\n              let regionIndex = 1;\r\n              Object.values(city.region).forEach(region => {\r\n                const regionId = String(regionIndex).padStart(2, '0');\r\n                const regionCode = provinceId + cityId + regionId;\r\n                areaList.county_list[regionCode] = region.name;\r\n\r\n                // 保存新旧区县ID的映射，必须6位数字才能标识一个 region\r\n                idMappingTemp.region[region.id] = regionCode\r\n\r\n                regionIndex++;\r\n              });\r\n            }\r\n            cityIndex++;\r\n          });\r\n        }\r\n        provinceIndex++;\r\n      });\r\n\r\n      this.idMapping = idMappingTemp\r\n      return areaList;\r\n    },\r\n  },\r\n  methods: {\r\n    ...mapActions('address', ['addAddress']), // 添加地址 的方法\r\n\r\n    // 点击保存按钮\r\n    async onSave(form) {\r\n      // console.log(form)\r\n      // 编辑地址\r\n      await this.addAddress({\r\n        name: form.name,\r\n        phone: form.tel,\r\n        regions: [ // 省市区数据\r\n          {\r\n            label: form.province,\r\n            // 现在手里有的是 areaCode，areaCode 是包含了省市区数据的，前两位是省的数据，前四位是市的数据，6位是区的数字\r\n            // 只有前两位才是省的数据，所以必须满足 province[key] 的前两位就是 areaCode 的前两位\r\n            value: Object.keys(this.province).find(key => this.province[key].startsWith(form.areaCode.slice(0, 2))),\r\n          },\r\n          {\r\n            label: form.city,\r\n            value: Object.keys(this.city).find(key => this.city[key].startsWith(form.areaCode.slice(0, 4))),\r\n          },\r\n          {\r\n            label: form.county,\r\n            value: Object.keys(this.region).find(key => this.region[key] === form.areaCode),\r\n          },\r\n        ],\r\n        detail: form.addressDetail // 详细地址\r\n      })\r\n\r\n      this.$router.go(-1) // 保存成功就返回上一级页面\r\n\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<template>\r\n  <div class=\"addAddress\">\r\n    <van-nav-bar placeholder fixed title=\"新增收货地址\" left-arrow @click-left=\"$router.go(-1)\"/>\r\n\r\n    <div class=\"edit\" style=\"height: calc(100vh - 46px)\">\r\n      <div class=\"title\" style=\"padding: 12px 12px 0 12px;\">\r\n        收货地址\r\n      </div>\r\n\r\n      <van-address-edit\r\n          :area-list=\"areaList\"\r\n          @save=\"onSave\"\r\n      />\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<style scoped lang=\"less\">\r\n.edit {\r\n  background-color: #f7f8fa;\r\n\r\n  .title {\r\n    color: #abb4ba;\r\n    font-size: 14px;\r\n  }\r\n\r\n  ::v-deep .van-button {\r\n    background: linear-gradient(90deg, #f9211c, #ff6335);\r\n    border: 0;\r\n  }\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./AddAddress.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./AddAddress.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./AddAddress.vue?vue&type=template&id=5d957de4&scoped=true\"\nimport script from \"./AddAddress.vue?vue&type=script&lang=js\"\nexport * from \"./AddAddress.vue?vue&type=script&lang=js\"\nimport style0 from \"./AddAddress.vue?vue&type=style&index=0&id=5d957de4&prod&scoped=true&lang=less\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"5d957de4\",\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","staticClass","attrs","on","$event","$router","go","staticStyle","_v","areaList","onSave","staticRenderFns","name","created","res","getRegionApi","originAreaList","data","list","idMapping","province","city","region","computed","province_list","city_list","county_list","idMappingTemp","provinceIndex","provinces","Object","values","forEach","provinceId","String","padStart","provinceCode","id","cityIndex","cityId","cityCode","regionIndex","regionId","regionCode","methods","mapActions","form","addAddress","phone","tel","regions","label","value","keys","find","key","startsWith","areaCode","slice","county","detail","addressDetail","component"],"sourceRoot":""}