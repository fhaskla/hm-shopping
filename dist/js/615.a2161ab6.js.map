{"version":3,"file":"js/615.a2161ab6.js","mappings":"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","sources":["webpack://hm-shopping/./src/views/AddressEdit/AddressEdit.vue","webpack://hm-shopping/src/views/AddressEdit/AddressEdit.vue","webpack://hm-shopping/./src/views/AddressEdit/AddressEdit.vue?5064","webpack://hm-shopping/./src/views/AddressEdit/AddressEdit.vue?97ee"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"addressEdit\"},[_c('van-nav-bar',{attrs:{\"placeholder\":\"\",\"fixed\":\"\",\"title\":\"编辑收货地址\",\"left-arrow\":\"\"},on:{\"click-left\":function($event){return _vm.$router.go(-1)}}}),_c('div',{staticClass:\"edit\",staticStyle:{\"height\":\"calc(100vh - 46px)\"}},[_c('div',{staticClass:\"title\",staticStyle:{\"padding\":\"12px 12px 0 12px\"}},[_vm._v(\" 收货地址 \")]),_c('van-address-edit',{attrs:{\"address-info\":_vm.addressInfo,\"area-list\":_vm.areaList},on:{\"save\":_vm.onSave}})],1)],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<script>\r\nimport {getRegionApi} from \"@/api/address\";\r\nimport {mapActions, mapState} from \"vuex\";\r\n\r\nexport default {\r\n  name: \"AddressEdit\",\r\n  async created() {\r\n    // 获取后端的省市区数据\r\n    const res = await getRegionApi()\r\n    this.originAreaList = res.data.list\r\n\r\n    // 请求地址列表\r\n    await this.getAddressList()\r\n  },\r\n  data() {\r\n    return {\r\n      addressId: +this.$route.query.addressId, // 路由携带过来的查询参数,记得转为数字\r\n      originAreaList: null, // 原始省市区列表\r\n      // 存储新旧ID的映射关系，idMapping 在初始的时候只有 province，city，region 是响应式的\r\n      // 后续往 idMapping 里加的东西都不是响应式的，这就是Vue2的响应式缺陷\r\n      // 在 addressInfo 依赖了 idMapping.region 里的一个数据\r\n      // 想着 idMapping.region 更新会触发这个 getters，结果 idMapping.region 里的东西是非响应式的\r\n      // 那也就说明不会重新触发 addressInfo 这个 getters\r\n      idMapping: {\r\n        province: {}, // { oldId: newId }\r\n        city: {},\r\n        region: {}\r\n      }\r\n    }\r\n  },\r\n  computed: {\r\n    province() {\r\n      return this.idMapping.province\r\n    },\r\n    city() {\r\n      return this.idMapping.city\r\n    },\r\n    region() {\r\n      return this.idMapping.region\r\n    },\r\n\r\n    ...mapState('address', ['addressList']), // 地址列表数据\r\n\r\n    // 传递给组件的省市区数据\r\n    areaList() {\r\n      // 没有后端的省市区数据直接返回空对象\r\n      if (!this.originAreaList) return {}\r\n\r\n      const areaList = {\r\n        province_list: {},\r\n        city_list: {},\r\n        county_list: {}\r\n      };\r\n\r\n      // 创建临时的 idMapping，等会填充完把 data 中的 idMapping 整个换掉，确保响应式\r\n      // addressInfo 这个 getters 会在 idMapping 整个换掉的时候再次触发，这个方案更好\r\n      // 其实 $set 方案也不错，$set 往一个对象obj加入一个带有 get 和 set 的属性 a，并且会触发对象 obj 的所有依赖\r\n      // 如果 obj 的依赖中有使用了 obj.a 的地方，此时属性 a 趁机收集自己的依赖，也是一个完美的方案\r\n      const idMappingTemp = {\r\n        province: {}, // { oldId: newId } 其实就是后端返回的 id 和组件要求的 id 不一致\r\n        city: {},\r\n        region: {}\r\n      }\r\n\r\n      let provinceIndex = 1;\r\n      const provinces = this.originAreaList\r\n\r\n      Object.values(provinces).forEach(province => {\r\n        const provinceId = String(provinceIndex).padStart(2, '0');\r\n        const provinceCode = provinceId + '0000';\r\n        areaList.province_list[provinceCode] = province.name;\r\n\r\n        // 保存新旧省份ID的映射，这里的 provinceId 是只有两位的，provinceCode 是有六位的\r\n        idMappingTemp.province[province.id] = provinceCode\r\n\r\n        if (province.city) {\r\n          let cityIndex = 1;\r\n          Object.values(province.city).forEach(city => {\r\n            const cityId = String(cityIndex).padStart(2, '0');\r\n            const cityCode = provinceId + cityId + '00';\r\n            areaList.city_list[cityCode] = city.name;\r\n\r\n            // 保存新旧城市ID的映射\r\n            idMappingTemp.city[city.id] = cityCode\r\n\r\n            if (city.region) {\r\n              let regionIndex = 1;\r\n              Object.values(city.region).forEach(region => {\r\n                const regionId = String(regionIndex).padStart(2, '0');\r\n                const regionCode = provinceId + cityId + regionId;\r\n                areaList.county_list[regionCode] = region.name;\r\n\r\n                // 保存新旧区县ID的映射，必须6位数字才能标识一个 region\r\n                idMappingTemp.region[region.id] = regionCode\r\n\r\n                regionIndex++;\r\n              });\r\n            }\r\n            cityIndex++;\r\n          });\r\n        }\r\n        provinceIndex++;\r\n      });\r\n\r\n      this.idMapping = idMappingTemp\r\n      return areaList;\r\n    },\r\n\r\n    // 传递给组件的初始显示值\r\n    addressInfo() {\r\n      // 没有后端的地址列表，直接返回空对象\r\n      if (!this.addressList.length) return {}\r\n\r\n      // 拿到当前的地址对象，里面就有后端的省市区的id\r\n      const obj = this.addressList.find(item => item.address_id === this.addressId)\r\n\r\n      if (!obj) return {} // 如果 obj 是空对象直接return\r\n\r\n      return {\r\n        id: obj.address_id,\r\n        name: obj.name,\r\n        tel: obj.phone,\r\n        // 通过后端给的省市区 id 查表生成组件需要的省市区 id\r\n        areaCode: this.region[obj.region_id],\r\n        addressDetail: obj.detail\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    ...mapActions('address', ['getAddressList', 'editAddress']), // 请求地址列表数据 和 编辑地址 的方法\r\n\r\n    // 点击保存按钮\r\n    async onSave(form) {\r\n      // console.log(form)\r\n      // 编辑地址\r\n      await this.editAddress({\r\n        addressId: this.addressId,\r\n        name: form.name,\r\n        phone: form.tel,\r\n        regions: [ // 省市区数据\r\n          {\r\n            label: form.province,\r\n            // 现在手里有的是 areaCode，areaCode 是包含了省市区数据的，前两位是省的数据，前四位是市的数据，6位是区的数字\r\n            // 只有前两位才是省的数据，所以必须满足 province[key] 的前两位就是 areaCode 的前两位\r\n            value: Object.keys(this.province).find(key => this.province[key].startsWith(form.areaCode.slice(0, 2))),\r\n          },\r\n          {\r\n            label: form.city,\r\n            value: Object.keys(this.city).find(key => this.city[key].startsWith(form.areaCode.slice(0, 4))),\r\n          },\r\n          {\r\n            label: form.county,\r\n            value: Object.keys(this.region).find(key => this.region[key] === form.areaCode),\r\n          },\r\n        ],\r\n        detail: form.addressDetail // 详细地址\r\n      })\r\n\r\n      this.$router.go(-1) // 保存成功就返回上一级页面\r\n\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<template>\r\n  <div class=\"addressEdit\">\r\n    <van-nav-bar placeholder fixed title=\"编辑收货地址\" left-arrow @click-left=\"$router.go(-1)\"/>\r\n\r\n    <div class=\"edit\" style=\"height: calc(100vh - 46px)\">\r\n      <div class=\"title\" style=\"padding: 12px 12px 0 12px;\">\r\n        收货地址\r\n      </div>\r\n\r\n      <van-address-edit\r\n          :address-info=\"addressInfo\"\r\n          :area-list=\"areaList\"\r\n          @save=\"onSave\"\r\n      />\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<style scoped lang=\"less\">\r\n.edit {\r\n  background-color: #f7f8fa;\r\n\r\n  .title {\r\n    color: #abb4ba;\r\n    font-size: 14px;\r\n  }\r\n\r\n  ::v-deep .van-button {\r\n    background: linear-gradient(90deg, #f9211c, #ff6335);\r\n    border: 0;\r\n  }\r\n}\r\n\r\n</style>\r\n","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./AddressEdit.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./AddressEdit.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./AddressEdit.vue?vue&type=template&id=2f6c4adf&scoped=true\"\nimport script from \"./AddressEdit.vue?vue&type=script&lang=js\"\nexport * from \"./AddressEdit.vue?vue&type=script&lang=js\"\nimport style0 from \"./AddressEdit.vue?vue&type=style&index=0&id=2f6c4adf&prod&scoped=true&lang=less\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"2f6c4adf\",\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","staticClass","attrs","on","$event","$router","go","staticStyle","_v","addressInfo","areaList","onSave","staticRenderFns","name","created","res","getRegionApi","originAreaList","data","list","getAddressList","addressId","$route","query","idMapping","province","city","region","computed","mapState","province_list","city_list","county_list","idMappingTemp","provinceIndex","provinces","Object","values","forEach","provinceId","String","padStart","provinceCode","id","cityIndex","cityId","cityCode","regionIndex","regionId","regionCode","addressList","length","obj","find","item","address_id","tel","phone","areaCode","region_id","addressDetail","detail","methods","mapActions","form","editAddress","regions","label","value","keys","key","startsWith","slice","county","component"],"sourceRoot":""}